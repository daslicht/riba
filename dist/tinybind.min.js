!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.tinybind=t():e.tinybind=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isJson=s,t.parseType=function(e){var t=r.PRIMITIVE,n=e;if(void 0===e)return{type:t,value:void 0};i.test(e)?n=e.slice(1,-1):"true"===e?n=!0:"false"===e?n=!1:"null"===e?n=null:"undefined"===e?n=void 0:isNaN(Number(e))?s(e)?n=JSON.parse(e):t=r.KEYPATH:n=Number(e);return{type:t,value:n}},t.parseTemplate=function(e,t){var n=null,r=e.length,i=0,s=0,u=t[0],c=t[1];for(;s<r;){if((i=e.indexOf(u,s))<0){n&&n.push({type:a,value:e.slice(s)});break}if(n=n||[],i>0&&s<i&&n.push({type:a,value:e.slice(s,i)}),s=i+u.length,(i=e.indexOf(c,s))<0){var l=e.slice(s-c.length),h=n[n.length-1];h&&h.type===a?h.value+=l:n.push({type:a,value:l});break}var f=e.slice(s,i).trim();n.push({type:o,value:f}),s=i+c.length}return n};var r=n(1),i=/^'.*'$|^".*"$/,a=0,o=1;function s(e){try{var t=JSON.parse(e);return t instanceof Array||t instanceof Object}catch(e){return!1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_PROPERTYNAME=t.KEYPATH=t.PRIMITIVE=void 0;t.PRIMITIVE=0;t.KEYPATH=1;t.DEFAULT_PROPERTYNAME="_binder"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.tinybind=void 0;var r=n(0),i=n(9),a=function(e){return e&&e.__esModule?e:{default:e}}(n(8)),o=n(7),s=n(5),u=n(3);var c=function(e,t){return t&&Object.keys(t).forEach(function(n){e[n]&&e[n]!=={}||(e[n]=t[n])}),e},l={binders:o.binders,components:{},formatters:i.formatters,adapters:{".":a.default},_prefix:"rv",_fullPrefix:"rv-",get prefix(){return this._prefix},set prefix(e){this._prefix=e,this._fullPrefix=e+"-"},parseTemplate:r.parseTemplate,parseType:r.parseType,templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,handler:function(e,t,n){this.call(e,t,n.view.models)},fallbackBinder:function(e,t){if(!this.type)throw new Error("Can't set atttribute of "+this.type);null!=t?e.setAttribute(this.type,t):e.removeAttribute(this.type)},configure:function(e){var t=this;e&&Object.keys(e).forEach(function(n){var r=e[n];switch(n){case"binders":c(t.binders,r);break;case"formatters":c(t.formatters,r);break;case"components":c(t.components,r);break;case"adapters":case"adapter":c(t.adapters,r);break;case"prefix":t.prefix=r;break;case"parseTemplate":t.parseTemplate=r;break;case"parseType":t.parseType=r;break;case"prefix":t.prefix=r;break;case"templateDelimiters":t.templateDelimiters=r;break;case"rootInterface":t.rootInterface=r;break;case"preloadData":t.preloadData=r;break;default:console.warn("Option not supported",n,r)}})},init:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t||(t=document.createElement("div"));var r=l.components[e];t.innerHTML=r.template.call(l,t);var i=r.initialize.call(l,t,n),a=l.bind(t,i);return a.bind(),a},bind:function(e,t,n){var r={binders:Object.create(null),formatters:Object.create(null),components:Object.create(null),adapters:Object.create(null),starBinders:Object.create(null),rootInterface:Object.create(null)};t=t||Object.create(null),n&&(c(r.binders,n.binders),c(r.formatters,n.formatters),c(r.components,n.components),c(r.adapters,n.adapters)),r.prefix=n&&n.prefix?n.prefix:l.prefix,r.templateDelimiters=n&&n.templateDelimiters?n.templateDelimiters:l.templateDelimiters,r.rootInterface=n&&n.rootInterface?n.rootInterface:l.rootInterface,r.preloadData=n&&n.preloadData?n.preloadData:l.preloadData,r.handler=n&&n.handler?n.handler:l.handler,c(r.binders,l.binders),c(r.formatters,l.formatters),c(r.components,l.components),c(r.adapters,l.adapters),r.starBinders=Object.keys(r.binders).filter(function(e){return e.indexOf("*")>0}),u.Observer.updateOptions(r);var i=new s.View(e,t,r);return i.bind(),i}};t.tinybind=l;var h=l;t.default=h},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return"object"===a(e)&&null!==e}var s,u,c;Object.defineProperty(t,"__esModule",{value:!0}),t.Observer=void 0;var l=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"keypath",void 0),i(this,"callback",void 0),i(this,"objectPath",void 0),i(this,"obj",void 0),i(this,"target",void 0),i(this,"key",void 0),i(this,"tokens",void 0),this.keypath=n,this.callback=r,this.objectPath=[];var a=this.parse();this.key=a.key,this.tokens=a.tokens,this.obj=this.getRootObject(t),this.target=this.realize(),o(this.target)&&this.set(!0,this.key,this.target,this.callback)}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"parse",value:function(){var t,n;if(u.length||function(e){throw new Error("[Observer] "+e)}("Must define at least one adapter interface."),~u.indexOf(this.keypath[0])?(n=this.keypath[0],t=this.keypath.substr(1)):(n=c,t=this.keypath),this.tokens=e.tokenize(t,n),!this.tokens.length)throw new Error("no tokens");return this.key=this.tokens.pop(),{key:this.key,tokens:this.tokens}}},{key:"realize",value:function(){for(var e,t,n=this.obj,r=-1,i=0;i<this.tokens.length;i++)t=this.tokens[i],o(n)?(void 0!==this.objectPath[i]?n!==(e=this.objectPath[i])&&(this.set(!1,t,e,this),this.set(!0,t,n,this),this.objectPath[i]=n):(this.set(!0,t,n,this),this.objectPath[i]=n),n=this.get(t,n)):(-1===r&&(r=i),(e=this.objectPath[i])&&this.set(!1,t,e,this));return-1!==r&&this.objectPath.splice(r),n}},{key:"sync",value:function(){var e,t,n;(e=this.realize())!==this.target?(o(this.target)&&this.set(!1,this.key,this.target,this.callback),o(e)&&this.set(!0,this.key,e,this.callback),t=this.value(),this.target=e,((n=this.value())!==t||n instanceof Function)&&this.callback.sync()):e instanceof Array&&this.callback.sync()}},{key:"value",value:function(){if(o(this.target))return this.get(this.key,this.target)}},{key:"setValue",value:function(e){o(this.target)&&s[this.key.i].set(this.target,this.key.path,e)}},{key:"get",value:function(e,t){return s[e.i].get(t,e.path)}},{key:"set",value:function(e,t,n,r){e?s[t.i].observe(n,t.path,r):s[t.i].unobserve(n,t.path,r)}},{key:"unobserve",value:function(){for(var e,t,n=0;n<this.tokens.length;n++)t=this.tokens[n],(e=this.objectPath[n])&&this.set(!1,t,e,this);o(this.target)&&this.set(!1,this.key,this.target,this.callback)}},{key:"getRootObject",value:function(e){var t,n;if(!e.$parent)return e;for(t=this.tokens.length?this.tokens[0].path:this.key.path,n=e;n.$parent&&void 0===n[t];)n=n.$parent;return n}}]),e}();t.Observer=l,i(l,"updateOptions",function(e){s=e.adapters,u=Object.keys(s),c=e.rootInterface}),i(l,"tokenize",function(e,t){var n,r,i=[],a={i:t,path:""};for(n=0;n<e.length;n++)r=e.charAt(n),~u.indexOf(r)?(i.push(a),a={i:r,path:""}):a.path+=r;return i.push(a),i})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Binding=void 0;var r=n(0),i=n(3),a=n(1);function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g,l=/\s+/;var h=function(){function e(t,n,r,i,o,s,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"observers",{}),u(this,"view",void 0),u(this,"el",void 0),u(this,"type",void 0),u(this,"binder",void 0),u(this,"formatters",void 0),u(this,"formatterObservers",void 0),u(this,"primitives",{}),u(this,"keypaths",{}),u(this,"args",void 0),u(this,"model",{}),u(this,"marker",void 0),u(this,"_bound",void 0),u(this,"customData",void 0),this.view=t,this.el=n,this.type=r,this.binder=o,this.args=s,this.formatters=c,this.formatterObservers={},this.model[a.DEFAULT_PROPERTYNAME]=void 0,this.customData={},console.log("new binder",this.type),this.keypaths[a.DEFAULT_PROPERTYNAME]=null!==i?i:"FIXME"}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"observe",value:function(e,t,n){return n?new i.Observer(e,t,n):new i.Observer(e,t,this)}},{key:"parseTarget",value:function(){for(var e in this.keypaths)if(this.keypaths.hasOwnProperty(e)){var t=this.keypaths[e];if(t){var n=(0,r.parseType)(t);if(n.type===a.PRIMITIVE)this.primitives[e]=n.value;else{if(n.type!==a.KEYPATH)throw new Error("Unknown type in token");this.observers[e]=this.observe(this.view.models,t),this.model[e]=this.observers[e].target}}else this.primitives[e]=void 0}}},{key:"getIterationAlias",value:function(e){return"%"+e+"%"}},{key:"parseFormatterArguments",value:function(e,t){var n=this;return e.map(r.parseType).map(function(e,r){var i=e.type,o=e.value;if(i===a.PRIMITIVE)return o;if(i===a.KEYPATH){var s=o;n.formatterObservers[t]||(n.formatterObservers[t]={});var u=n.formatterObservers[t][r];return u||(u=n.observe(n.view.models,s),n.formatterObservers[t][r]=u),u.value()}throw new Error("Unknown argument type")})}},{key:"formattedValue",value:function(e){var t=this;return null===this.formatters?e:this.formatters.reduce(function(e,n,r){var i=n.match(c);if(null===i)throw new Error("No args matched from FORMATTER_ARGS");var a=i.shift();if(!a)throw new Error("No id found in args");var s=t.view.options.formatters[a],u=t.parseFormatterArguments(i,r);return s&&s.read instanceof Function?e=s.read.apply(s,[e].concat(o(u))):s instanceof Function&&(e=s.apply(void 0,[e].concat(o(u)))),e},e)}},{key:"eventHandler",value:function(e){var t=this,n=this,r=n.view.options.handler;return function(i){if(!r)throw new Error("No handler defined in binding.view.options.handler");r.call(e,t,i,n)}}},{key:"set",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.DEFAULT_PROPERTYNAME;if(e instanceof Function&&!this.binder.function?(e=e,e=this.formattedValue(e.call(this.model[n]))):(e=e,e=this.formattedValue(e)),null===this.binder)throw new Error("binder is null");this.binder.hasOwnProperty("routine")?(this.binder=this.binder,t=this.binder.routine):(this.binder=this.binder,t=this.binder),t instanceof Function&&t.call(this,this.el,e)}},{key:"sync",value:function(){for(var e in this.observers)if(this.observers.hasOwnProperty(e)){var t=this.observers[e];if(t)this.model[e]=t.target,this.set(t.value(),e);else{var n=this.primitives[e];this.set(n,e)}}}},{key:"publish",value:function(){var e=this;if(this.observers){if(null===this.formatters)throw new Error("formatters is null");for(var t in this.observers)if(this.observers.hasOwnProperty(t)){var n=this.observers[t],r=this.formatters.reduceRight(function(t,n,r){var i=n.split(l),a=i.shift();if(!a)throw new Error("id not defined");var s=e.view.options.formatters[a],u=e.parseFormatterArguments(i,r);return s&&s.publish&&(t=s.publish.apply(s,[t].concat(o(u)))),t},this.getValue(this.el));n.setValue(r)}}}},{key:"bind",value:function(){if(this.parseTarget(),this.binder&&this.binder.hasOwnProperty("bind")){if(this.binder=this.binder,!this.binder.bind&&"function"!=typeof this.binder.bind)throw new Error("the method bind is not a function");this.binder.bind.call(this,this.el)}this.view.options.preloadData&&this.sync()}},{key:"unbind",value:function(){var e=this;if(null===this.binder)throw new Error("binder is null");if(this.binder.hasOwnProperty("bind")&&(this.binder=this.binder,this.binder.unbind&&this.binder.unbind.call(this,this.el)),this.observers)for(var t in this.observers){if(this.observers.hasOwnProperty(t))this.observers[t].unobserve()}Object.keys(this.formatterObservers).forEach(function(t){var n=e.formatterObservers[t];Object.keys(n).forEach(function(e){n[e].unobserve()})}),this.formatterObservers={}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.observers)for(var t in this.observers)if(this.observers.hasOwnProperty(t)){var n=this.observers[t];this.model[t]=n.target}if(null===this.binder)throw new Error("binder is null");this.binder.hasOwnProperty("update")&&(this.binder=this.binder,this.binder.update&&this.binder.update.call(this,e))}},{key:"getValue",value:function(e){if(null===this.binder)throw new Error("binder is null");if(this.binder.hasOwnProperty("getValue")){if(this.binder=this.binder,"function"!=typeof this.binder.getValue)throw new Error("getValue is not a function");return this.binder.getValue.call(this,e)}return function(e){var t=[];if("checkbox"===e.type)return e.checked;if("select-multiple"===e.type){var n=e.options;for(var r in n)if(n.hasOwnProperty(r)){var i=n[r];i.selected&&t.push(i.value)}return t}return e.value}(e)}}]),e}();t.Binding=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.View=void 0;var r=n(2),i=n(4),a=n(6),o=n(0);function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c={routine:function(e,t){e.data=null!=t?t:""}},l=/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g,h=function e(t,n){var i=!1;if(3===(n=n).nodeType){if(!n.data)throw new Error("node has no data");var a=(0,o.parseTemplate)(n.data,r.tinybind.templateDelimiters);if(a){if(!n.parentNode)throw new Error("Node has no parent node");for(var s=0;s<a.length;s++){var u=a[s],l=document.createTextNode(u.value);n.parentNode.insertBefore(l,n),1===u.type&&t.buildBinding(l,null,u.value,c,null)}n.parentNode.removeChild(n)}i=!0}else 1===n.nodeType&&(i=t.traverse(n));if(!i&&n.childNodes)for(var h=0;h<n.childNodes.length;h++)e(t,n.childNodes[h])},f=function(e,t){var n=e.binder&&e.binder.priority||0;return(t.binder&&t.binder.priority||0)-n},d=function(e){return e.trim()},p=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),u(this,"els",void 0),u(this,"models",void 0),u(this,"options",void 0),u(this,"bindings",[]),u(this,"componentView",null),t instanceof Array?this.els=t:this.els=[t],console.log("view options",r),this.models=n,this.options=r,this.build()}return function(e,t,n){t&&s(e.prototype,t),n&&s(e,n)}(e,[{key:"buildBinding",value:function(e,t,n,r,a){var o=n.match(l);if(null===o)throw new Error("no matches");var s=o.map(d),u=s.shift()||null;this.bindings.push(new i.Binding(this,e,t,u,r,a,s))}},{key:"build",value:function(){this.bindings=[];var e,t,n=this.els;for(e=0,t=n.length;e<t;e++)h(this,n[e]);this.bindings.sort(f)}},{key:"traverse",value:function(e){for(var t,n,i,o,s=r.tinybind._fullPrefix,u="SCRIPT"===e.nodeName||"STYLE"===e.nodeName,c=e.attributes,l=[],h=this.options.starBinders,f=0,d=c.length;f<d;f++){var p=c[f];if(0===p.name.indexOf(s)){if(t=p.name.slice(s.length),o=[],!(n=this.options.binders[t]))for(var v=0;v<h.length;v++)if(i=h[v],t.slice(0,i.length-1)===i.slice(0,-1)){n=this.options.binders[i],o.push(t.slice(i.length-1));break}if(n||(n=r.tinybind.fallbackBinder),n.block)return this.buildBinding(e,t,p.value,n,o),e.removeAttribute(p.name),!0;l.push({attr:p,binder:n,type:t,args:o})}}for(var b=0;b<l.length;b++){var m=l[b];this.buildBinding(e,m.type,m.attr.value,m.binder,m.args),e.removeAttribute(m.attr.name)}return u||(t=e.nodeName.toLowerCase(),this.options.components[t]&&!e._bound&&(this.bindings.push(new a.ComponentBinding(this,e,t)),u=!0)),u}},{key:"bind",value:function(){this.bindings.forEach(function(e){e.bind()})}},{key:"unbind",value:function(){Array.isArray(this.bindings)&&this.bindings.forEach(function(e){e.unbind()}),this.componentView&&this.componentView.unbind()}},{key:"sync",value:function(){this.bindings.forEach(function(e){e.sync()})}},{key:"publish",value:function(){this.bindings.forEach(function(e){e.binder&&e.binder.publishes&&e.publish()})}},{key:"update",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(t).forEach(function(n){e.models[n]=t[n]}),this.bindings.forEach(function(e){e.update&&e.update(t)})}}]),e}();t.View=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ComponentBinding=void 0;var r=n(2),i=n(0),a=n(4),o=n(1);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(e,t){return t&&Object.keys(t).forEach(function(n){e[n]&&e[n]!=={}||(e[n]=t[n])}),e},p=function(e){function t(e,n,i){var a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),f(h(h(a=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?h(e):t}(this,c(t).call(this,e,n,i,null,null,null,null)))),"view",void 0),f(h(h(a)),"componentView",void 0),f(h(h(a)),"el",void 0),f(h(h(a)),"type",void 0),f(h(h(a)),"component",void 0),f(h(h(a)),"primitives",void 0),f(h(h(a)),"keypaths",{}),f(h(h(a)),"observers",void 0),f(h(h(a)),"bindingPrefix",r.tinybind._fullPrefix),a.view=e,a.el=n,a.type=i,a.component=e.options.components[a.type],a.primitives={},a.observers={},a.parseTarget(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(t,a.Binding),function(e,t,n){t&&u(e.prototype,t),n&&u(e,n)}(t,[{key:"parseTarget",value:function(){for(var e=0,t=this.el.attributes.length;e<t;e++){var n=this.el.attributes[e];if(0!==n.name.indexOf(this.bindingPrefix)){var r=this.camelCase(n.name),a=(0,i.parseType)(n.value);if(a.type===o.PRIMITIVE)this.primitives[r]=a.value;else{if(a.type!==o.KEYPATH)throw new Error("can't parse component attribute");this.keypaths[r]=n.value,this.observers[r]=this.observe(this.view.models,this.keypaths[r],this),this.model[r]=this.observers[r].target}}}}},{key:"sync",value:function(){}},{key:"update",value:function(){}},{key:"publish",value:function(){}},{key:"locals",value:function(){var e=this,t={};return Object.keys(this.primitives).forEach(function(n){t[n]=e.formattedValue(e.primitives[n]),t[n]=e.primitives[n]}),Object.keys(this.observers).forEach(function(n){t[n]=e.observers[n].target}),t}},{key:"camelCase",value:function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})}},{key:"getMergedOptions",value:function(){var e={binders:Object.create(null),formatters:Object.create(null),components:Object.create(null),adapters:Object.create(null)};return d(e.binders,this.component.binders),d(e.formatters,this.component.formatters),d(e.components,this.component.components),d(e.adapters,this.component.adapters),d(e.binders,this.view.options.binders),d(e.formatters,this.view.options.formatters),d(e.components,this.view.options.components),d(e.adapters,this.view.options.adapters),e.prefix=this.component.prefix?this.component.prefix:this.view.options.prefix,e.templateDelimiters=this.component.templateDelimiters?this.component.templateDelimiters:this.view.options.templateDelimiters,e.rootInterface=this.component.rootInterface?this.component.rootInterface:this.view.options.rootInterface,e.preloadData=this.component.preloadData?this.component.preloadData:this.view.options.preloadData,e.handler=this.component.handler?this.component.handler:this.view.options.handler,e}},{key:"bind",value:function(){if(this.componentView)this.componentView.bind();else{this.el.innerHTML=this.component.template.call(this);var e=this.component.initialize.call(this,this.el,this.locals());this.componentView=r.tinybind.bind(Array.prototype.slice.call(this.el.childNodes),e,this.getMergedOptions())}}},{key:"unbind",value:function(){var e=this;Object.keys(this.observers).forEach(function(t){e.observers[t].unobserve()}),this.componentView&&this.componentView.unbind.call(this)}}]),t}();t.ComponentBinding=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.binders=void 0;var r=n(5),i=function(e){return null!=e?e.toString():void 0},a=function(e,t,n){var i=e.el.cloneNode(!0),a=new r.View(i,t,e.view.options);if(a.bind(),!e||!e.marker||null===e.marker.parentNode)throw new Error("No parent node for binding!");return e.marker.parentNode.insertBefore(i,n),a},o={"on-*":{function:!0,priority:1e3,bind:function(e){this.customData||(this.customData={handler:null})},unbind:function(e){if(this.customData.handler){if(null===this.args)throw new Error("args is null");e.removeEventListener(this.args[0],this.customData)}},routine:function(e,t){if(this.customData.handler){if(null===this.args)throw new Error("args is null");e.removeEventListener(this.args[0],this.customData.handler)}if(this.customData.handler=this.eventHandler(t),null===this.args)throw new Error("args is null");e.addEventListener(this.args[0],this.customData.handler)}},"each-*":{block:!0,priority:4e3,bind:function(e){if(this.marker)this.customData.iterated.forEach(function(e){e.bind()});else{if(this.marker=document.createComment(" tinybind: ".concat(this.type," ")),this.customData={iterated:[]},!e.parentNode)throw new Error("No parent node!");e.parentNode.insertBefore(this.marker,e),e.parentNode.removeChild(e)}},unbind:function(e){this.customData.iterated&&this.customData.iterated.forEach(function(e){e.unbind()})},routine:function(e,t){var n=this;if(null===this.args)throw new Error("args is null");var r=this.args[0];if(t=t||[],!Array.isArray(t))throw new Error("each-"+r+" needs an array to iterate over, but it is");var i=e.getAttribute("index-property")||this.getIterationAlias(r);t.forEach(function(e,t){var o={$parent:n.view.models};o[i]=t,o[r]=e;var s=n.customData.iterated[t];if(s)if(s.models[r]!==e){for(var u,c,l=t+1;l<n.customData.iterated.length;l++)if((c=n.customData.iterated[l]).models[r]===e){u=l;break}if(void 0!==u){if(n.customData.iterated.splice(u,1),!n.marker||!n.marker.parentNode)throw new Error("Marker has no parent node");n.marker.parentNode.insertBefore(c.els[0],s.els[0]),c.models[i]=t}else c=a(n,o,s.els[0]);n.customData.iterated.splice(t,0,c)}else s.models[i]=t;else{var h;if(n.customData.iterated.length)h=n.customData.iterated[n.customData.iterated.length-1].els[0];else{if(!n.marker)throw new Error("previous not defined");h=n.marker}s=a(n,o,h.nextSibling),n.customData.iterated.push(s)}}),this.customData.iterated.length>t.length&&function(e,t){for(var n=0;n<e;n++)t()}(this.customData.iterated.length-t.length,function(){var e=n.customData.iterated.pop();if(e.unbind(),!n.marker||!n.marker.parentNode)throw new Error("Marker has no parent node");n.marker.parentNode.removeChild(e.els[0])}),"OPTION"===e.nodeName&&this.view.bindings&&this.view.bindings.forEach(function(e){n.marker&&e.el===n.marker.parentNode&&"value"===e.type&&e.sync()})},update:function(e){var t=this,n={};Object.keys(e).forEach(function(r){if(null===t.args)throw new Error("args is null");r!==t.args[0]&&(n[r]=e[r])}),this.customData.iterated.forEach(function(e){e.update(n)})}},"class-*":function(e,t){var n=" ".concat(e.className," ");if(null===this.args)throw new Error("args is null");t!==n.indexOf(" ".concat(this.args[0]," "))>-1&&(e.className=t?"".concat(e.className," ").concat(this.args[0]):n.replace(" ".concat(this.args[0]," ")," ").trim())},text:function(e,t){e.textContent=null!=t?t:""},html:function(e,t){console.log("html",e,t),e.innerHTML=null!=t?t:""},show:function(e,t){e.style.display=t?"":"none"},hide:function(e,t){e.style.display=t?"none":""},enabled:function(e,t){e.disabled=!t},disabled:function(e,t){e.disabled=!!t},checked:{publishes:!0,priority:2e3,bind:function(e){var t=this;this.customData={},this.customData.callback||(this.customData.callback=function(){t.publish()}),e.addEventListener("change",this.customData.callback)},unbind:function(e){e.removeEventListener("change",this.customData.callback)},routine:function(e,t){"radio"===e.type?e.checked=i(e.value)===i(t):e.checked=!!t}},value:{publishes:!0,priority:3e3,bind:function(e){if(this.customData={},this.customData.isRadio="INPUT"===e.tagName&&"radio"===e.type,!this.customData.isRadio){this.customData.event=e.getAttribute("event-name")||("SELECT"===e.tagName?"change":"input");var t=this;this.customData.callback||(this.customData.callback=function(){t.publish()}),e.addEventListener(this.customData.event,this.customData.callback)}},unbind:function(e){this.customData.isRadio||e.removeEventListener(this.customData.event,this.customData.callback)},routine:function(e,t){if(this.customData&&this.customData.isRadio)e.setAttribute("value",t);else if("select-multiple"===e.type&&e instanceof HTMLSelectElement){if(t instanceof Array)for(var n=0;n<e.length;n++){var r=e[n];r.selected=t.indexOf(r.value)>-1}}else i(t)!==i(e.value)&&(e.value=null!=t?t:"")}},if:{block:!0,priority:4e3,bind:function(e){if(this.customData={},this.marker)!1===this.customData.bound&&this.customData.nested&&this.customData.nested.bind();else{var t=this.keypaths?this.keypaths[0]:"";if(this.marker=document.createComment(" tinybind: "+this.type+" "+t+" "),this.customData.attached=!1,!e.parentNode)throw new Error("Element has no parent node");e.parentNode.insertBefore(this.marker,e),e.parentNode.removeChild(e)}this.customData.bound=!0},unbind:function(){this.customData.nested&&(this.customData.nested.unbind(),this.customData.bound=!1)},routine:function(e,t){if((t=!!t)!==this.customData.attached)if(t){if(this.customData.nested||(this.customData.nested=new r.View(e,this.view.models,this.view.options),this.customData.nested.bind()),!this.marker||!this.marker.parentNode)throw new Error("Marker has no parent node");this.marker.parentNode.insertBefore(e,this.marker.nextSibling),this.customData.attached=!0}else{if(!e.parentNode)throw new Error("Element has no parent node");e.parentNode.removeChild(e),this.customData.attached=!1}},update:function(e){this.customData.nested&&this.customData.nested.update(e)}}};t.binders=o;var s=o;t.default=s},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.Adapter=void 0;var a=["push","pop","shift","unshift","sort","reverse","splice"],o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"counter",0),i(this,"weakmap",{})}return function(e,t,n){t&&r(e.prototype,t),n&&r(e,n)}(e,[{key:"weakReference",value:function(e){if(!e.hasOwnProperty("__rv")){var t=this.counter++;Object.defineProperty(e,"__rv",{value:t})}return this.weakmap[e.__rv]||(this.weakmap[e.__rv]={callbacks:{}}),this.weakmap[e.__rv]}},{key:"cleanupWeakReference",value:function(e,t){Object.keys(e.callbacks).length||e.pointers&&Object.keys(e.pointers).length||delete this.weakmap[t]}},{key:"stubFunction",value:function(e,t){var n=e[t],r=this.weakReference(e),i=this.weakmap;e[t]=function(){for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];var s=n.apply(e,a);return Object.keys(r.pointers).forEach(function(e){var t=r.pointers[e];i[e]&&i[e].callbacks[t]instanceof Array&&i[e].callbacks[t].forEach(function(e){e.sync()})}),s}}},{key:"observeMutations",value:function(e,t,n){var r=this;if(e instanceof Array){var i=this.weakReference(e);i.pointers||(i.pointers={},a.forEach(function(t){r.stubFunction(e,t)})),i.pointers[t]||(i.pointers[t]=[]),-1===i.pointers[t].indexOf(n)&&i.pointers[t].push(n)}}},{key:"unobserveMutations",value:function(e,t,n){if(e instanceof Array&&null!=e.__rv){var r=this.weakmap[e.__rv];if(r){var i=r.pointers[t];if(i){var a=i.indexOf(n);a>-1&&i.splice(a,1),i.length||delete r.pointers[t],this.cleanupWeakReference(r,e.__rv)}}}}},{key:"observe",value:function(e,t,n){var r,i=this,a=this.weakReference(e).callbacks;if(!a[t]){a[t]=[];var o=Object.getOwnPropertyDescriptor(e,t);o&&(o.get||o.set||!o.configurable)||(r=e[t],Object.defineProperty(e,t,{enumerable:!0,get:function(){return r},set:function(n){if(n!==r){i.unobserveMutations(r,e.__rv,t),r=n;var a=i.weakmap[e.__rv];if(a){var o=a.callbacks[t];o&&o.forEach(function(e){e.sync()}),i.observeMutations(n,e.__rv,t)}}}}))}-1===a[t].indexOf(n)&&a[t].push(n),this.observeMutations(e[t],e.__rv,t)}},{key:"unobserve",value:function(e,t,n){var r=this.weakmap[e.__rv];if(r){var i=r.callbacks[t];if(i){var a=i.indexOf(n);a>-1&&(i.splice(a,1),i.length||(delete r.callbacks[t],this.unobserveMutations(e[t],e.__rv,t))),this.cleanupWeakReference(r,e.__rv)}}}},{key:"get",value:function(e,t){return e[t]}},{key:"set",value:function(e,t,n){e[t]=n}}]),e}();t.Adapter=o;var s=new o;t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.formatters=void 0;var r={};t.formatters=r,r.not=function(e){return!e}}]).default});